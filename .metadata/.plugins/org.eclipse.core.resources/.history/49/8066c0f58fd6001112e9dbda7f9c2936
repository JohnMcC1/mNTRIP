package com.mntripclient;

import java.io.FileInputStream;
import java.io.FileNotFoundException;
import java.io.FileOutputStream;
import java.util.ArrayList;

import android.annotation.SuppressLint;
import android.graphics.Canvas;
import android.graphics.Color;
import android.graphics.Paint;
import android.graphics.Point;

import com.google.android.maps.GeoPoint;
import com.google.android.maps.MapView;
import com.google.android.maps.Overlay;
import com.google.android.maps.Projection;

@SuppressLint("ParserError")
public class GPSRouteOverlay extends Overlay {

	private ArrayList<GeoPoint> geoPoints = new ArrayList<GeoPoint>();
	private MapView mapView;
	
	Projection projection;
	Point startPoint;
	Point stopPoint;
	Paint paint;
	
	public GPSRouteOverlay(MapView mapView) {
		this.mapView = mapView;
		mapView.invalidate();
		paint = new Paint();
		paint.setAntiAlias(true);
		paint.setColor(Color.DKGRAY);
		paint.setStrokeWidth(4); 
		paint.setAlpha(200);
		
		startPoint = new Point();
		stopPoint = new Point();
	}

	@Override
	public void draw(Canvas canvas, MapView mapView, boolean shadow) {
		if ((!shadow) && (geoPoints.size() > 1)) {
			
			projection = mapView.getProjection();
			
			for (int i  = 0; i < (geoPoints.size() - 1); i++) {
				projection.toPixels(geoPoints.get(i), startPoint);
				projection.toPixels(geoPoints.get(i + 1), stopPoint);
				canvas.drawLine(startPoint.x, startPoint.y, stopPoint.x, stopPoint.y, paint);
			}
		}
	}

	public void addGeoPoint(GeoPoint geoPoint) {
		geoPoints.add(geoPoint);
		mapView.invalidate();
	}
	
	public void readPointsFromFile(String fileName) {
		geoPoints.clear();
		try {
			FileInputStream fileInputStream = new FileInputStream(fileName);
			StringBuffer buffer = new StringBuffer("");
			
		     while( (c = fileInputStream.read()) != -1) {
		    	 buffer.append((char) c);
		     }
			
		} catch (FileNotFoundException e) {
		}
	}
	
	public void clear() {
		geoPoints.clear();
		mapView.invalidate();
	}
	
}
